import os, csv, json
from cve_searchsploit import update_db as update_cve_db

thisDir = os.path.dirname(__file__)

def update_edb():
    update_cve_db()
    PoCList = {}
    with open(os.path.join(thisDir, 'exploitdb/files_exploits.csv'), 'r') as f:
        reader = csv.reader(f)
        # skip header
        # ['id', 'file', 'description', 'date_published', 'author', 'type', 'platform', 'port', 'date_added', 'date_updated', 'verified', 'codes', 'tags', 'aliases', 'screenshot_url', 'application_url', 'source_url']
        next(reader)
        for row in reader:
            PoCList[row[0]] = {}
            PoCList[row[0]]['file'] = os.path.join(thisDir, 'exploitdb', row[1])
            PoCList[row[0]]['description'] = row[2]
            PoCList[row[0]]['date_published'] = row[3]
    with open(os.path.join(thisDir, 'exploitdb_mapping_PoC.json'), 'w') as f:
        json.dump(PoCList, f, indent=4)

update_edb()